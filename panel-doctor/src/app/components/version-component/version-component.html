<div class="page-wrapper">
  <!-- Sidebar -->
  <aside class="sidebar" [class.abierto]="menuAbierto">
    <div class="logo-container">
      <button class="menu-icon" (click)="toggleMenu()">☰</button>
      <h3>MENU</h3>
    </div>

    <nav>
      <button class="nav-btn" (click)="Database()">
        <span class="text">DATABASE</span>
      </button>
      <button class="nav-btn" (click)="Formulario()">
        <span class="text">FORMULARIO</span>
      </button>

      <div class="submenu">
        <button class="submenu-item" (click)="FormularioVersiones()">
          <span>FORMULARIO</span>
        </button>
        <button class="submenu-item" (click)="Version()">
          <span>VERSIONES</span>
        </button>
      </div>
    </nav>
  </aside>

  <!-- Contenido principal -->
  <div class="main-content">
    <div class="form-container">
      <h2 class="form-title">Formulario de Versiones</h2>

      <!-- Formulario reactivo -->
      <form *ngIf="miFormulario" [formGroup]="miFormulario" (ngSubmit)="onSubmit()">
        
        <!-- Consentimiento -->
        <div class="form-group">
          <label>Consentimiento</label>
          <select formControlName="consentimientoId"
                  [class.input-error]="miFormulario.get('consentimientoId')?.invalid && miFormulario.get('consentimientoId')?.touched">
            <option value="">Seleccionar consentimiento</option>
            <option *ngFor="let c of consentimientosDisponibles" [value]="c.id">
              Consentimiento #{{ c.id }} - {{ c.id_consentimiento }}
            </option>
          </select>
          <span class="error-msg"
                *ngIf="miFormulario.get('consentimientoId')?.invalid && miFormulario.get('consentimientoId')?.touched">
            Debes seleccionar un consentimiento
          </span>
        </div>

        <!-- ✅ NUEVO CAMPO: Código Interno (solo lectura, se rellena automático) -->
        <div class="form-group">
          <label>Código Interno</label>
          <input 
            type="text" 
            [value]="codigoInternoSeleccionado" 
            readonly 
            class="input-readonly"
            placeholder="Se rellena automáticamente al seleccionar consentimiento">
        </div>

        <!-- Número de versión -->
        <div class="form-group">
          <label>Número de versión</label>
          <input type="text" formControlName="numeroVersion" placeholder="Ej: 2.0 o V.2"
                 [class.input-error]="miFormulario.get('numeroVersion')?.invalid && miFormulario.get('numeroVersion')?.touched">
          <span class="error-msg"
                *ngIf="miFormulario.get('numeroVersion')?.invalid && miFormulario.get('numeroVersion')?.touched">
            El número de versión es obligatorio
          </span>
        </div>

        <!-- Fecha -->
        <div class="form-group">
          <label>Fecha</label>
          <input type="date" formControlName="fecha"
                 [class.input-error]="miFormulario.get('fecha')?.invalid && miFormulario.get('fecha')?.touched">
          <span class="error-msg"
                *ngIf="miFormulario.get('fecha')?.invalid && miFormulario.get('fecha')?.touched">
            La fecha es obligatoria
          </span>
        </div>

        <!-- Correo electrónico -->
        <div class="form-group">
          <label>Correo electrónico</label>
          <input type="email" formControlName="correo" placeholder="usuario@correo.com"
                 [class.input-error]="miFormulario.get('correo')?.invalid && miFormulario.get('correo')?.touched">
          <span class="error-msg"
                *ngIf="miFormulario.get('correo')?.invalid && miFormulario.get('correo')?.touched">
            El correo es obligatorio y debe tener formato válido
          </span>
        </div>

        <!-- Confirmación -->
        <div class="form-group checkbox-wrapper">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="consentimiento" class="checkbox-input">
            <span class="checkbox-text">Confirmo que los datos son correctos</span>
          </label>
          <span class="error-msg"
                *ngIf="miFormulario.get('consentimiento')?.invalid && miFormulario.get('consentimiento')?.touched">
            Debes confirmar antes de guardar
          </span>
        </div>

        <!-- Botones -->
        <div class="button-group">
          <button type="submit" class="btn guardar" [disabled]="miFormulario.invalid">GUARDAR</button>
          <button type="button" (click)="eliminar()" class="btn eliminar">ELIMINAR</button>
        </div>

        <!-- Botón volver -->
        <div class="button-group-left">
          <button type="button" (click)="volver()" class="btn volver">← VOLVER</button>
        </div>
      </form>

      <!-- Cargando -->
      <div *ngIf="!miFormulario" class="loading">
        Cargando formulario...
      </div>
    </div>
  </div>
</div>